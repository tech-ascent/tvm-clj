<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>tvm-clj.compiler documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">tvm-clj</span> <span class="project-version">5.1-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="background.html"><div class="inner"><span># Justification</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tvm-clj</span></div></div></li><li class="depth-2 branch"><a href="tvm-clj.ast.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ast</span></div></a></li><li class="depth-2 branch current"><a href="tvm-clj.compiler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compiler</span></div></a></li><li class="depth-2 branch"><a href="tvm-clj.module.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>module</span></div></a></li><li class="depth-2"><a href="tvm-clj.schedule.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schedule</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="tvm-clj.compiler.html#var-assoc-attr"><div class="inner"><span>assoc-attr</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-bind-arguments"><div class="inner"><span>bind-arguments</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-build"><div class="inner"><span>build</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-build-for-device"><div class="inner"><span>build-for-device</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-C_PACKED_FUNC"><div class="inner"><span>C_PACKED_FUNC</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-current-pass-context-config"><div class="inner"><span>current-pass-context-config</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-declare-buffer"><div class="inner"><span>declare-buffer</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-DEFAULT"><div class="inner"><span>DEFAULT</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-DEVICE_KERNEL_LAUNCH"><div class="inner"><span>DEVICE_KERNEL_LAUNCH</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-int-.3Elowered-function-type-map"><div class="inner"><span>int-&gt;lowered-function-type-map</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-lower"><div class="inner"><span>lower</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-lowered-function-type-.3Eint-map"><div class="inner"><span>lowered-function-type-&gt;int-map</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-make-filter-pass"><div class="inner"><span>make-filter-pass</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-make-fn-pass"><div class="inner"><span>make-fn-pass</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-map-pass"><div class="inner"><span>map-pass</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-rvalue-reference"><div class="inner"><span>rvalue-reference</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-schedule-.3Efunction"><div class="inner"><span>schedule-&gt;function</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-sequential-pass"><div class="inner"><span>sequential-pass</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-tvm-fn-attrs"><div class="inner"><span>tvm-fn-attrs</span></div></a></li><li class="depth-1"><a href="tvm-clj.compiler.html#var-TVMModImport"><div class="inner"><span>TVMModImport</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">tvm-clj.compiler</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-assoc-attr"><h3>assoc-attr</h3><div class="usage"><code>(assoc-attr relay-expr attr-name attr-value &amp; args)</code></div><div class="doc"><div class="markdown"><p>Create a new copy of the function and update the attribute.</p>
<h2><a href="#parameters" name="parameters"></a>Parameters</h2>
<ul>
  <li>
  <p>attr_key_or_dict : Union[str, dict]  The attribute key to use or a dict containing multiple key value pairs.</p></li>
  <li>
  <p>attr_value : Object  The new attribute value.</p></li>
</ul>
<h2><a href="#returns" name="returns"></a>Returns</h2>
<ul>
  <li>func : Function - A new copy of the function.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L122">view source</a></div></div><div class="public anchor" id="var-bind-arguments"><h3>bind-arguments</h3><div class="usage"><code>(bind-arguments arg-list compact? bind-map)</code></div><div class="doc"><div class="markdown"><p>Given an arg-list and existing bind map, produce a new arg list and bind map with all arguments bound to input buffers with defined buffer layout. Bind map is a map of type NodeHandle-&gt;NodeHandle where the keys are tensors and the values are buffers. The default is to bind a compact, non-offset buffer so if you want a different buffer type than this then you need to bind it yourself.</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L250">view source</a></div></div><div class="public anchor" id="var-build"><h3>build</h3><div class="usage"><code>(build fn-map {:keys [target-host], :or {target-host "llvm"}})</code><code>(build fn-map)</code></div><div class="doc"><div class="markdown"><p>Build a map of function entries. fn-entries is a map of name to fn-data and fn-data is a map containing:</p>
<ul>
  <li><code>:schedule</code> - schedule to use.</li>
  <li><code>:arguments</code> - argument declarations to the function</li>
  <li><code>:bind-map</code> - optional map of argument to bind declaration to declare the  memory layout of the argument.</li>
  <li><code>:simple-mode?</code> - optional boolean to indicate not to perform optimizations  that result in an unreadable AST.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L484">view source</a></div></div><div class="public anchor" id="var-build-for-device"><h3>build-for-device</h3><div class="usage"><code>(build-for-device input-mod target target-host)</code></div><div class="doc"><div class="markdown"><p>Build the lowered functions for a device with the given compilation target.</p>
<h2><a href="#parameters" name="parameters"></a>Parameters</h2>
<p>input_mod : IRModule  The schedule to be built.</p>
<p>target : str or :any:<code>tvm.target.Target</code>  The target and option of the compilation.</p>
<p>target_host : str or :any:<code>tvm.target.Target</code>  The host compilation target.</p>
<h2><a href="#returns" name="returns"></a>Returns</h2>
<p>fhost : IRModule  The host IRModule.</p>
<p>mdev : tvm.module  A module that contains device code.</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L406">view source</a></div></div><div class="public anchor" id="var-C_PACKED_FUNC"><h3>C_PACKED_FUNC</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L397">view source</a></div></div><div class="public anchor" id="var-current-pass-context-config"><h3>current-pass-context-config</h3><div class="usage"><code>(current-pass-context-config)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L277">view source</a></div></div><div class="public anchor" id="var-declare-buffer"><h3>declare-buffer</h3><div class="usage"><code>(declare-buffer shape &amp; {:keys [dtype name data strides elem-offset scope data-alignment], :or {name "buffer", dtype "float32", scope "", data-alignment -1}})</code></div><div class="doc"><div class="markdown"><p>Decleare a new symbolic buffer.</p>
<p>Normally buffer is created automatically during lower and build.  This is only needed if user want to specify their own buffer layout.</p>
<p>See the note below for detailed discussion on usage of buffer.</p>
<p>Parameters  ———-  shape : tuple of Expr  The shape of the buffer.</p>
<p>dtype : str, optional  The data type of the buffer.</p>
<p>name : str, optional  The name of the buffer.</p>
<p>data : Var, optional  The data pointer in the buffer.</p>
<p>strides: array of Expr  The stride of the buffer.</p>
<p>elem_offset: Expr, optional  The beginning offset of the array to data.  In terms of number of elements of dtype.</p>
<p>scope: str, optional  The storage scope of the buffer, if not global.  If scope equals empty string, it means it is global memory.</p>
<p>data_alignment: int, optional  The alignment of data pointer in bytes.  If -1 is passed, the alignment will be set to TVM’s internal default.</p>
<p>–CN - REMOVED - No one understands what this does. It is only referenced in the code in order to perform a check during argument binding. So the description below is accurate for what it is worth but it is hard to me to see how this is useful.</p>
<p>offset_factor: int, optional  The factor of elem_offset field, when set,  elem_offset is required to be multiple of offset_factor.  If 0 is pssed, the alignment will be set to 1.  if non-zero is passed, we will created a Var for elem_offset if elem_offset is not None.</p>
<p>–CN - END-REMOVED –</p>
<p>Returns  ——-  buffer : Buffer  The created buffer</p>
<p>Note  —-  Buffer data structure reflects the DLTensor structure in dlpack.  While DLTensor data structure is very general, it is usually helpful  to create function that only handles specific case of data structure  and make compiled function benefit from it.</p>
<p>If user pass strides and elem_offset is passed as None  when constructing the function, then the function will be specialized  for the DLTensor that is compact and aligned.  If user pass a fully generic symbolic array to the strides,  then the resulting function becomes fully generic.</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L165">view source</a></div></div><div class="public anchor" id="var-DEFAULT"><h3>DEFAULT</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L398">view source</a></div></div><div class="public anchor" id="var-DEVICE_KERNEL_LAUNCH"><h3>DEVICE_KERNEL_LAUNCH</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L396">view source</a></div></div><div class="public anchor" id="var-int-.3Elowered-function-type-map"><h3>int-&gt;lowered-function-type-map</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L162">view source</a></div></div><div class="public anchor" id="var-lower"><h3>lower</h3><div class="usage"><code>(lower sch args {:keys [name binds simple-mode? optimization-level], :or {name "main", optimization-level 2}})</code></div><div class="doc"><div class="markdown"><p>Lowering step before build into target.</p>
<h2><a href="#parameters" name="parameters"></a>Parameters</h2>
<p>sch : tvm.te.schedule.Schedule  The schedule to be built</p>
<p>args : list of Buffer or Tensor or Var  The argument lists to the function.</p>
<p>name : str, optional  The name of result function.</p>
<p>binds : dict of :any:<code>Tensor</code> to :any:<code>Buffer</code>, optional  Dictionary that maps the Tensor to Buffer which specified the data layout  requirement of the function. By default, a new compact buffer is created  for each tensor in the argument.</p>
<p>simple_mode : bool, optional  Whether only output simple and compact statement, this will skip  LoopPartition, api wrapper generation and Unrolling.</p>
<h2><a href="#returns" name="returns"></a>Returns</h2>
<p>m : IRModule or Stmt  The result IRModule, if simple_mode=False  Then the Stmt before make api is returned.</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L326">view source</a></div></div><div class="public anchor" id="var-lowered-function-type-.3Eint-map"><h3>lowered-function-type-&gt;int-map</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L156">view source</a></div></div><div class="public anchor" id="var-make-filter-pass"><h3>make-filter-pass</h3><div class="usage"><code>(make-filter-pass filter-fn {:keys [opt-level fname required], :or {opt-level 0, fname "Filter", required []}})</code><code>(make-filter-pass filter-fn)</code></div><div class="doc"><div class="markdown"><p>Filter functions by the calling convention attribute.</p>
<h2><a href="#parameters" name="parameters"></a>Parameters</h2>
<p>fcond : tvm.tir.PrimFunc -&gt; bool  The condition of the filtering.</p>
<h2><a href="#returns" name="returns"></a>Returns</h2>
<p>fpass : tvm.transform.Pass  The result pass</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L57">view source</a></div></div><div class="public anchor" id="var-make-fn-pass"><h3>make-fn-pass</h3><div class="usage"><code>(make-fn-pass map-fn {:keys [opt-level fname required], :or {opt-level 0, fname "Apply", required []}})</code><code>(make-fn-pass map-fn)</code></div><div class="doc"><div class="markdown"><p>Define a TVM compiler pass given a clojure fn. Fn is a function from IRModule-&gt;IRModule.</p>
<p>Options:</p>
<ul>
  <li>
  <p><code>opt_level</code> : <code>int</code>  The optimization level of this module pass. Defaults to zero which guarantees  it will run. Optimization levels go from 0 to at least 2.</p></li>
  <li>
  <p><code>name</code> : Optional[str]  The name of the function pass. The name could be empty. In this case, the  name of the optimization function will be used as the pass name.</p></li>
  <li>
  <p><code>required</code> : Optional[List[str]]  The list of passes that the function pass is dependent on.</p></li>
</ul></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L31">view source</a></div></div><div class="public anchor" id="var-map-pass"><h3>map-pass</h3><div class="usage"><code>(map-pass map-fn options ir-module)</code><code>(map-pass map-fn ir-module)</code></div><div class="doc"><div class="markdown"><p>Map a function across an IRModule potentially modifying the input IRModule. The IRModule is returned.</p>
<p>map-fn is expected to be a function from IRModule-&gt;IRModule.</p>
<p>Options : See options for <code>fn-pass</code></p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L84">view source</a></div></div><div class="public anchor" id="var-rvalue-reference"><h3>rvalue-reference</h3><div class="usage"><code>(rvalue-reference node)</code></div><div class="doc"><div class="markdown"><p>Create an RValue reference to the object and mark the object as moved.</p>
<p>This marks the object letting the TVM system know that it will not be  accessed by caller after this point.</p>
<p>A unique reference may trigger a copy on write optimization that avoids  a copy when we mutably transform an object.</p>
<p>Note  —-  All the reference of the object becomes invalid after it is moved.  Be very careful when using this feature.</p>
<p>Examples  ——–</p>
<p><code>clojure
</code></p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L98">view source</a></div></div><div class="public anchor" id="var-schedule-.3Efunction"><h3>schedule-&gt;function</h3><div class="usage"><code>(schedule-&gt;function sch args name binds)</code></div><div class="doc"><div class="markdown"><p>According to the given schedule, form a function.</p>
<h2><a href="#parameters" name="parameters"></a>Parameters</h2>
<p>sch : tvm.te.schedule.Schedule  The given scheduler to form the raw body</p>
<p>args : list of Buffer or Tensor or Var  The argument lists to the function.</p>
<p>name : str  The name of result function.</p>
<p>binds : dict of :any:<code>Tensor</code> to :any:<code>Buffer</code>, optional  The binds information</p>
<h2><a href="#returns" name="returns"></a>Returns</h2>
<p>The body formed according to the given schedule</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L282">view source</a></div></div><div class="public anchor" id="var-sequential-pass"><h3>sequential-pass</h3><div class="usage"><code>(sequential-pass mod {:keys [optimization-level], :or {optimization-level 2}} pass-list)</code><code>(sequential-pass mod pass-list)</code></div><div class="doc"><div class="markdown"><p>Perform a sequential pass, using the passes defined in the pass list and returning a new ir module.</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L19">view source</a></div></div><div class="public anchor" id="var-tvm-fn-attrs"><h3>tvm-fn-attrs</h3><div class="usage"><code>(tvm-fn-attrs item)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L400">view source</a></div></div><div class="public anchor" id="var-TVMModImport"><h3>TVMModImport</h3><div class="usage"><code>(TVMModImport this other)</code></div><div class="doc"><div class="markdown"><p>Import a tvm module into this</p></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tvm_clj/compiler.clj#L476">view source</a></div></div></div></body></html>